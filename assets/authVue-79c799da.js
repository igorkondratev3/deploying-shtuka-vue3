import{s as k,r,o as w,c as b,a,w as y,x as C,n as x,y as S,F as L,z as A,A as M,u as T,f as z,b as B,p as $,B as N,v as E,_ as U,j as q,C as O}from"./index-8d7d6877.js";const P=async(h,u,g)=>{try{return await(await fetch(`https://shtuka-api.onrender.com/user/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:g})})).json()}catch{return{error:"Ошибка доступа к серверу"}}};const Z=a("h3",{class:"auth__title"},"Вход",-1),j=a("label",{for:"email"},"Email:",-1),I=a("label",{for:"password"},"Пароль:",-1),J=["disabled"],R={__name:"loginAuth",emits:["showError"],setup(h,{emit:u}){const g=k(),o=r(""),n=r(""),l=r(!1),_=r(null),t=r(null),e=r(null),i=r(!1),f=()=>(i.value&&(e.value.setCustomValidity(""),e.value.removeEventListener("input",f),i.value=!1),t.value.reportValidity()?e.value.validity.valueMissing?(e.value.setCustomValidity("Заполните это поле"),e.value.reportValidity(),e.value.addEventListener("input",f),i.value=!0,!1):e.value.validity.patternMismatch?(e.value.setCustomValidity("Некорректный пароль"),e.value.reportValidity(),e.value.addEventListener("input",f),i.value=!0,!1):!0:!1),V=m=>m.error?(l.value=!1,m.error==="Некорректный пароль"?(e.value.setCustomValidity("Некорректный пароль"),e.value.reportValidity(),setTimeout(()=>e.value.setCustomValidity(""),1500),!1):m.error==="Ошибка доступа к серверу"?(u("showError",m.error),!1):(t.value.setCustomValidity("Некорректный email"),t.value.reportValidity(),setTimeout(()=>t.value.setCustomValidity(""),1500),!1)):!0,c=async(m,d)=>{if(!f())return;l.value=!0;const s=await P("login",m,d);V(s)&&(localStorage.setItem("user",JSON.stringify(s)),g.login(s),l.value=!1,A.postMessage("login"))};return(m,d)=>(w(),b(L,null,[Z,a("form",{ref_key:"formLogin",ref:_,class:"auth__form form-auth"},[j,y(a("input",{class:"form-auth__input",id:"email",type:"email",ref_key:"emailLogin",ref:t,"onUpdate:modelValue":d[0]||(d[0]=s=>o.value=s),maxlength:"40",required:""},null,512),[[C,o.value]]),I,y(a("input",{class:"form-auth__input",id:"password",type:"password",ref_key:"passwordLogin",ref:e,"onUpdate:modelValue":d[1]||(d[1]=s=>n.value=s),maxlength:"80",pattern:"(?=.*[0-9])(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z!@#$%^&*]{8,}",required:""},null,512),[[C,n.value]]),a("button",{class:x(["form-auth__button",{disabled:l.value}]),disabled:l.value,onClick:d[2]||(d[2]=S(s=>c(o.value,n.value),["prevent"]))}," Войти ",10,J)],512)],64))}};const D=a("h3",{class:"auth__title"},"Регистрация",-1),F={ref:"formLogin",class:"auth__form form-auth"},G=a("label",{for:"email"},"Email:",-1),H=a("label",{for:"password"},"Пароль:",-1),K=a("label",{for:"repeat-password"},"Подтвердите пароль:",-1),Q=["disabled"],W={__name:"signupAuth",emits:["showError"],setup(h,{emit:u}){const g=k(),o=r(""),n=r(""),l=r(""),_=r(!1),t=r(null),e=r(null),i=r(null),f=r(!1),V=r(!1),c=()=>(f.value&&(e.value.setCustomValidity(""),e.value.removeEventListener("input",c),f.value=!1),V.value&&(i.value.setCustomValidity(""),i.value.removeEventListener("input",c),V.value=!1),t.value.reportValidity()?e.value.validity.valueMissing?(e.value.setCustomValidity("Заполните это поле"),e.value.reportValidity(),e.value.addEventListener("input",c),f.value=!0,!1):e.value.validity.patternMismatch?(e.value.setCustomValidity("Пароль должен быть не менее 8 символов, содержащих латинские буквы в верхнем и нижнем регистре, цифры и спецсимволы"),e.value.reportValidity(),e.value.addEventListener("input",c),f.value=!0,!1):n.value!==l.value?(i.value.setCustomValidity("Пароль и подтверждение не совпадают"),i.value.reportValidity(),i.value.addEventListener("input",c),V.value=!0,!1):!0:!1),m=s=>s.error?(_.value=!1,s.error==="Пароль недостаточно надежный"?(e.value.setCustomValidity(s.error),e.value.reportValidity(),setTimeout(()=>e.value.setCustomValidity(""),1500),!1):s.error==="Ошибка доступа к серверу"?(u("showError",s.error),!1):(t.value.setCustomValidity(s.error),t.value.reportValidity(),setTimeout(()=>t.value.setCustomValidity(""),1500),!1)):!0,d=async(s,v)=>{if(!c())return;_.value=!0;const p=await P("signup",s,v);m(p)&&(localStorage.setItem("user",JSON.stringify(p)),g.login(p),_.value=!1,A.postMessage("login"))};return(s,v)=>(w(),b(L,null,[D,a("form",F,[G,y(a("input",{type:"email",id:"email","onUpdate:modelValue":v[0]||(v[0]=p=>o.value=p),class:"form-auth__input",ref_key:"emailSignup",ref:t,maxlength:"40",required:""},null,512),[[C,o.value]]),H,y(a("input",{type:"password","onUpdate:modelValue":v[1]||(v[1]=p=>n.value=p),class:"form-auth__input",id:"password",ref_key:"passwordSignup",ref:e,maxlength:"80",pattern:"(?=.*[0-9])(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z!@#$%^&*]{8,}",required:""},null,512),[[C,n.value]]),K,y(a("input",{type:"password","onUpdate:modelValue":v[2]||(v[2]=p=>l.value=p),class:"form-auth__input",id:"repeat-password",ref_key:"repeatPasswordSignup",ref:i,maxlength:"80",required:""},null,512),[[C,l.value]]),a("button",{onClick:v[3]||(v[3]=S(p=>d(o.value,n.value,l.value),["prevent"])),disabled:_.value,class:x(["form-auth__button",{disabled:_.value}])}," Зарегистрироваться ",10,Q)],512)],64))}},X=(h,u)=>{h.history.state.back?h.history.back():u.push({path:"/"})};const Y={class:"header header_margin header_height"},ee={class:"auth auth_margin"},te={__name:"authVue",setup(h){const u=r(!1);new URLSearchParams(document.location.search).get("start")==="signup"&&(u.value=!0);const o=k(),n=T(),l=r("");return z(()=>o.user,()=>{o.user&&X(window,n)}),(_,t)=>(w(),b(L,null,[a("header",Y,[B(O)]),a("div",ee,[(w(),$(N(u.value?W:R),{onShowError:t[0]||(t[0]=e=>l.value=e)},null,32)),y(a("a",{class:"auth__link nav-auth__login",onClick:t[1]||(t[1]=e=>u.value=!1)}," Вход ",512),[[E,u.value]]),y(a("a",{class:"auth__link nav-auth__signup",onClick:t[2]||(t[2]=e=>u.value=!0)}," Регистрация ",512),[[E,!u.value]])]),l.value?(w(),$(U,{key:0,class:"auth-error",error:l.value,onCloseError:t[3]||(t[3]=e=>l.value="")},null,8,["error"])):q("",!0)],64))}},se=M(te,[["__scopeId","data-v-1768b8d9"]]);export{se as default};
